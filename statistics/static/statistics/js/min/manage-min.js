function deleteInput(t){document.getElementById(t).remove()}function requestData(t,e,o){$.ajax({url:data_url,data:"data_type="+t+"&offset="+e+"&count="+o,success:function(e){"point"===t?(total_point=e.totaldata,offset_point+=o,"undefined"!=typeof e.datapoints[0].committee_by&&e.datapoints.forEach(function(t){createPoint(-1,t.pk,t.last_changed,t.committee_by,t.active_debate,t.round_no,t.point_type,t.subtopics,t.committee_color,t.committee_text_color),total_points_displayed++}),new_point===!1&&("undefined"!=typeof e.datapoints[0].pk&&(latest_point_pk=e.datapoints[0].pk),requestNewData("point"),new_point=!0)):"content"===t?(total_content=e.totaldata,offset_content+=o,"undefined"!=typeof e.datapoints[0].content&&e.datapoints.forEach(function(t){createContent(-1,t.pk,t.last_changed,t.committee_by,t.active_debate,t.content,t.point_type,t.committee_color,t.committee_text_color),total_content_displayed++}),new_content===!1&&("undefined"!=typeof e.datapoints[0].pk&&(latest_content_pk=e.datapoints[0].pk),requestNewData("content"),new_content=!0)):"vote"===t&&(total_vote=e.totaldata,offset_vote+=o,"undefined"!=typeof e.datapoints[0].committee_by&&e.datapoints.forEach(function(t){createVote(-1,t.pk,t.last_changed,t.committee_by,t.active_debate,t.in_favour,t.against,t.abstentions,t.absent,t.committee_color,t.committee_text_color),total_votes_displayed++}),new_vote===!1&&("undefined"!=typeof e.datapoints[0].pk&&(latest_vote_pk=e.datapoints[0].pk),requestNewData("vote"),new_vote=!0))},cache:!1})}function requestNewData(t){var e;"point"===t?e=latest_point_pk:"content"===t?e=latest_content_pk:"vote"===t&&(e=latest_vote_pk),$.ajax({url:data_latest_url,data:"data_type="+t+"&pk="+e,success:function(e){"point"===t?("undefined"!=typeof e.datapoints[0].pk&&(latest_point_pk=e.datapoints[0].pk),total_point=e.totaldata,"undefined"!=typeof e.datapoints[0].committee_by&&e.datapoints.forEach(function(t){offset_point++,createPoint(0,t.pk,t.last_changed,t.committee_by,t.active_debate,t.round_no,t.point_type,t.subtopics,t.committee_color,t.committee_text_color),total_points_displayed++})):"content"===t?("undefined"!=typeof e.datapoints[0].pk&&(latest_content_pk=e.datapoints[0].pk),total_content=e.totaldata,"undefined"!=typeof e.datapoints[0].content&&e.datapoints.forEach(function(t){offset_content++,createContent(0,t.pk,t.last_changed,t.committee_by,t.active_debate,t.content,t.point_type,t.committee_color,t.committee_text_color),total_content_displayed++})):"vote"===t&&("undefined"!=typeof e.datapoints[0].pk&&(latest_vote_pk=e.datapoints[0].pk),total_vote=e.totaldata,"undefined"!=typeof e.datapoints[0].committee_by&&e.datapoints.forEach(function(t){offset_vote++,createVote(0,t.pk,t.last_changed,t.committee_by,t.active_debate,t.in_favour,t.against,t.abstentions,t.absent,t.committee_color,t.committee_text_color),total_votes_displayed++})),setTimeout(requestNewData,3e3,t)},cache:!1})}function createPoint(t,e,o,n,a,i,s,l,c,d){var r=document.getElementById("point-table").getElementsByTagName("tbody")[0],p=r.insertRow(t),_=p.insertCell(0),u=p.insertCell(1),m=p.insertCell(2),v=p.insertCell(3),f=p.insertCell(4),b=p.insertCell(5),y=p.insertCell(6),h=p.insertCell(7);$(p).attr("id","point-"+e),$(p).css("display","none"),_.innerHTML=e,u.innerHTML=o,m.innerHTML=n,v.innerHTML=a,f.innerHTML=i,"P"===s?b.innerHTML='<img src="'+point_img+'" height="30" >':b.innerHTML='<img src="'+dr_img+'" height="30" >',y.innerHTML=l,h.innerHTML='<a href="javascript:void(0)" class="btn btn-xs btn-material-'+session_color+'-800 btn-fab btn-raised mdi-content-create" data-toggle="modal" data-target="#edit-point" onclick="editPoint(\''+e+'\')" ></a><a href="javascript:void(0)" class="btn btn-danger btn-fab btn-raised mdi-action-delete" onclick="deleteData(\'point\', \''+e+"')\" ></a>",$(m).addClass("label-material-"+c+"-400"),$(m).css("color",d),$(p).fadeIn("slow")}function createContent(t,e,o,n,a,i,s,l,c){var d=document.getElementById("content-table").getElementsByTagName("tbody")[0],r=d.insertRow(t),p=r.insertCell(0),_=r.insertCell(1),u=r.insertCell(2),m=r.insertCell(3),v=r.insertCell(4),f=r.insertCell(5),b=r.insertCell(6);$(r).attr("id","content-"+e),$(r).css("display","none"),p.innerHTML=e,_.innerHTML=o,u.innerHTML=n,m.innerHTML=a,v.innerHTML=i,"P"===s?f.innerHTML='<img src="'+point_img+'" height="30" >':f.innerHTML='<img src="'+dr_img+'" height="30" >',b.innerHTML='<a href="javascript:void(0)" class="btn btn-xs btn-material-'+session_color+'-800 btn-fab btn-raised mdi-content-create" data-toggle="modal" data-target="#edit-content" onclick="editContent(\''+e+'\')" ></a><a href="javascript:void(0)" class="btn btn-danger btn-fab btn-raised mdi-action-delete" onclick="deleteData(\'content\', \''+e+"')\" ></a>",$(u).addClass("label-material-"+l+"-400"),$(u).css("color",c),$(r).fadeIn("slow")}function createVote(t,e,o,n,a,i,s,l,c,d,r){var p=document.getElementById("vote-table").getElementsByTagName("tbody")[0],_=p.insertRow(t),u=_.insertCell(0),m=_.insertCell(1),v=_.insertCell(2),f=_.insertCell(3),b=_.insertCell(4),y=_.insertCell(5),h=_.insertCell(6),g=_.insertCell(7);vote_action=_.insertCell(8),$(_).attr("id","vote-"+e),$(_).css("display","none"),u.innerHTML=e,m.innerHTML=o,v.innerHTML=n,f.innerHTML=a,b.innerHTML=i,y.innerHTML=s,h.innerHTML=l,g.innerHTML=c,vote_action.innerHTML='<a href="javascript:void(0)" class="btn btn-xs btn-material-'+session_color+'-800 btn-fab btn-raised mdi-content-create" data-toggle="modal" data-target="#edit-vote" onclick="editVote(\''+e+'\')" ></a><a href="javascript:void(0)" class="btn btn-danger btn-fab btn-raised mdi-action-delete" onclick="deleteData(\'vote\', \''+e+"')\" ></a>",$(v).addClass("label-material-"+d+"-400"),$(v).css("color",r),$(_).fadeIn("slow")}function editPoint(t){var e="data_type=point&pk="+t;$.ajax({url:data_pk_url,data:e,success:function(t){$("#point_id_pk").val(t.pk),document.getElementById("point_id_committee").options.namedItem(t.committee_by).selected=!0,document.getElementById("point_id_debate").options.namedItem(t.active_debate).selected=!0,document.getElementById("point_id_round_no").options.namedItem(t.round_no).selected=!0,document.getElementById("point_id_point_type").options.namedItem(t.point_type).selected=!0;for(var e=document.getElementById("point_id_subtopics"),o=0;e.options.length>0;)e.options.remove(0);all_subtopics=[],t.all_subtopics.forEach(function(t){all_subtopics.push({pk:t.pk.toString()});var n=document.createElement("option");n.text=t.subtopic,$(n).attr("id",t.pk),$(n).attr("value",t.pk),e.options.add(n,o),o++}),console.log(all_subtopics),t.subtopics.forEach(function(t){e.options.namedItem(t.pk).selected=!0})},cache:!1})}function editContent(t){var e="data_type=content&pk="+t;$.ajax({url:data_pk_url,data:e,success:function(t){$("#content_id_pk").val(t.pk),$("#content_id_content").val(t.content),document.getElementById("content_id_committee").options.namedItem(t.committee_by).selected=!0,document.getElementById("content_id_debate").options.namedItem(t.active_debate).selected=!0,document.getElementById("content_id_point_type").options.namedItem(t.point_type).selected=!0},cache:!1})}function editVote(t){var e="data_type=vote&pk="+t;$.ajax({url:data_pk_url,data:e,success:function(t){$("#vote_id_pk").val(t.pk),$("#vote_id_in_favour").val(t.in_favour),$("#vote_id_against").val(t.against),$("#vote_id_abstentions").val(t.abstentions),$("#vote_id_absent").val(t.absent),document.getElementById("vote_id_committee").options.namedItem(t.committee_by).selected=!0,document.getElementById("vote_id_debate").options.namedItem(t.active_debate).selected=!0,getTotal()},cache:!1})}function getTotal(){var t=$("#vote_id_in_favour"),e=$("#vote_id_against"),o=$("#vote_id_abstentions"),n=$("#vote_id_absent");total=parseInt(t.val())+parseInt(e.val())+parseInt(o.val())+parseInt(n.val()),$("#vote-total").html(total)}function savePoint(){var t=[];$("#point_id_subtopics").val().forEach(function(e){t.push({pk:e})}),$.ajax({url:data_pk_url,type:"POST",data:{"data-type":"point",session:$("#point_id_session").val(),pk:$("#point_id_pk").val(),committee:$("#point_id_committee").val(),debate:$("#point_id_debate").val(),round_no:$("#point_id_round_no").val(),point_type:$("#point_id_point_type").val(),subtopics:JSON.stringify(t),all_subtopics:JSON.stringify(all_subtopics)},success:function(t){console.log("success!"),console.log(t),deleteInput("point-"+t.pk),createPoint(0,t.pk,t.last_changed,t.by,t.debate,t.round_no,t.point_type,t.subtopics,t.committee_color,t.committee_text_color),$("#edit-point").modal("hide"),$("#results").html('<div class="alert alert-dismissable alert-success"><button type="button" class="close" data-dismiss="alert">×</button>Point Saved</a>.</div>'),window.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3)},error:function(t,e,o){$("#results").html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+e+" <a href='#' class='close'>&times;</a></div>"),console.log(t.status+": "+t.responseText),$("#results").html('<div class="alert alert-dismissable alert-danger"><button type="button" class="close" data-dismiss="alert">×</button>There was an error, check your internet and try again!</a>.</div>'),window.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3)},cache:!1})}function saveContent(){$.ajax({url:data_pk_url,type:"POST",data:{"data-type":"content",session:$("#content_id_session").val(),pk:$("#content_id_pk").val(),committee:$("#content_id_committee").val(),debate:$("#content_id_debate").val(),point_type:$("#content_id_point_type").val(),content:$("#content_id_content").val()},success:function(t){console.log("success!"),console.log(t),deleteInput("content-"+t.pk),createContent(0,t.pk,t.last_changed,t.by,t.debate,t.content,t.point_type,t.committee_color,t.committee_text_color),$("#edit-content").modal("hide"),$("#results").html('<div class="alert alert-dismissable alert-success"><button type="button" class="close" data-dismiss="alert">×</button>Content Point Saved</a>.</div>'),window.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3)},error:function(t,e,o){$("#results").html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+e+" <a href='#' class='close'>&times;</a></div>"),console.log(t.status+": "+t.responseText),$("#results").html('<div class="alert alert-dismissable alert-danger"><button type="button" class="close" data-dismiss="alert">×</button>There was an error, check your internet and try again!</a>.</div>'),window.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3)},cache:!1})}function saveVote(){$.ajax({url:data_pk_url,type:"POST",data:{"data-type":"vote",session:$("#vote_id_session").val(),pk:$("#vote_id_pk").val(),committee:$("#vote_id_committee").val(),debate:$("#vote_id_debate").val(),in_favour:$("#vote_id_in_favour").val(),against:$("#vote_id_against").val(),abstentions:$("#vote_id_abstentions").val(),absent:$("#vote_id_absent").val()},success:function(t){console.log("success!"),console.log(t),deleteInput("vote-"+t.pk),createVote(0,t.pk,t.last_changed,t.by,t.debate,t.in_favour,t.against,t.abstentions,t.absent,t.committee_color,t.committee_text_color),$("#edit-vote").modal("hide"),$("#results").html('<div class="alert alert-dismissable alert-success"><button type="button" class="close" data-dismiss="alert">×</button>Vote Saved</a>.</div>'),window.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3)},error:function(t,e,o){$("#results").html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+e+" <a href='#' class='close'>&times;</a></div>"),console.log(t.status+": "+t.responseText),$("#results").html('<div class="alert alert-dismissable alert-danger"><button type="button" class="close" data-dismiss="alert">×</button>There was an error, check your internet and try again!</a>.</div>'),window.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3)},cache:!1})}function deleteData(t,e){confirm("Are you sure you want to delete this?")===!0&&$.ajax({url:data_pk_url,type:"POST",data:{"delete":!0,"data-type":t,pk:e},success:function(o){console.log("Delete success!"),deleteInput(t+"-"+e)},error:function(t,e,o){$("#results").html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+e+" <a href='#' class='close'>&times;</a></div>"),console.log(t.status+": "+t.responseText)},cache:!1})}function getCookie(t){var e=null;if(document.cookie&&""!=document.cookie)for(var o=document.cookie.split(";"),n=0;n<o.length;n++){var a=jQuery.trim(o[n]);if(a.substring(0,t.length+1)==t+"="){e=decodeURIComponent(a.substring(t.length+1));break}}return e}function csrfSafeMethod(t){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(t)}function sameOrigin(t){var e=document.location.host,o=document.location.protocol,n="//"+e,a=o+n;return t==a||t.slice(0,a.length+1)==a+"/"||t==n||t.slice(0,n.length+1)==n+"/"||!/^(\/\/|http:|https:).*/.test(t)}var offset_point=0,offset_content=0,total_point,total_content,total_points_displayed=0,total_content_displayed=0,latest_point_pk=0,latest_content_pk=0,new_point=!1,new_content=!1,offset_vote=0,total_vote,total_votes_displayed=0,latest_vote_pk=0,new_vote=!1,all_subtopics;Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var t=this.length-1;t>=0;t--)this[t]&&this[t].parentElement&&this[t].parentElement.removeChild(this[t])},$("input").keyup(getTotal),$(document).ready(getTotal),$("#point-form").on("submit",function(t){t.preventDefault(),console.log("Point form submitted!"),savePoint()}),$("#content-form").on("submit",function(t){t.preventDefault(),console.log("Content form submitted!"),saveContent()}),$("#vote-form").on("submit",function(t){t.preventDefault(),console.log("Vote form submitted!"),saveVote()}),jQuery(function($){$("#content-div").bind("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&total_content>total_content_displayed&&requestData("content",offset_content,10)})}),jQuery(function($){$("#point-div").bind("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&total_point>total_points_displayed&&requestData("point",offset_point,10)})}),jQuery(function($){$("#vote-div").bind("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&total_vote>total_votes_displayed&&requestData("vote",offset_vote,10)})});var csrftoken=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(t,e){!csrfSafeMethod(e.type)&&sameOrigin(e.url)&&t.setRequestHeader("X-CSRFToken",csrftoken)}});